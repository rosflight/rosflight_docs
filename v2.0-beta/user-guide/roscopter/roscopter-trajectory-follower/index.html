<!DOCTYPE html><html lang="en" class="no-js"><head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A lean, open-source autopilot system built by researchers, for researchers">
      
      
        <meta name="author" content="James Jackson, Daniel Koch, Ian Reid, Brandon Sutherland, Jacob Moore">
      
      
        <link rel="canonical" href="http://rosflight.org/v2.0-beta/user-guide/roscopter/roscopter-trajectory-follower/">
      
      
        <link rel="prev" href="../roscopter-path-manager/">
      
      
        <link rel="next" href="../roscopter-controller/">
      
      
      <link rel="icon" href="../../../assets/favicon.ico">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>ROScopter Trajectory Follower - ROSflight</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  <link href="../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"><script src="../../../assets/javascripts/glightbox.min.js"></script><style id="glightbox-style">
            html.glightbox-open { overflow: initial; height: 100%; }
            .gslide-title { margin-top: 0px; user-select: text; }
            .gslide-desc { color: #666; user-select: text; }
            .gslide-image img { background: white; }
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color); }
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color); }
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color); }
        </style></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-grey" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#trajectory-follower" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
You're not viewing the latest stable version.
<a href="../../../..">
  <strong>Click here to go to latest.</strong>
</a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),base=new URL("../../.."),outdated=__md_get("__outdated",sessionStorage,base);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="ROSflight" class="md-header__button md-logo" aria-label="ROSflight" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ROSflight
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              ROScopter Trajectory Follower
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../overview/" class="md-tabs__link">
          
  
  
  User Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../developer-guide/contribution-guidelines/" class="md-tabs__link">
          
  
  
  Developer Guide

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../publications/rosplane/" class="md-tabs__link">
          
  
  
  Publications

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="ROSflight" class="md-nav__button md-logo" aria-label="ROSflight" data-md-component="logo">
      
  <img src="../../../assets/logo.png" alt="logo">

    </a>
    ROSflight
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    User Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            User Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2">
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Installation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Installation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/installation-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation for Sim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/installation-hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Installation on Hardware
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/using-docker-with-rosflight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Docker with ROSflight
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3">
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tutorial-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorial overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/setting-up-rosflight-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Setting up ROSflight Sim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/manually-flying-rosflight-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Manually flying ROSflight Sim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/setting-up-roscopter-in-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running ROScopter in Sim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/setting-up-rosplane-in-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Running ROSplane in Sim
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/tuning-performance-in-sim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tuning performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_7">
        
          
          <label class="md-nav__link" for="__nav_2_3_7" id="__nav_2_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Transitioning from Sim to Hardware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3_7">
            <span class="md-nav__icon md-icon"></span>
            Transitioning from Sim to Hardware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/transitioning-from-sim-to-hardware/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/user-manual-xflr5/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Xflr5
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/user-manual-openvsp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    OpenVSP
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/user-manual-ROSflight-integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSflight Integration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/user-manual-appendix/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Appendix
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../rosflight-io/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSflightIO
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_5">
        
          
          <label class="md-nav__link" for="__nav_2_5" id="__nav_2_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ROSflight Sim
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_5">
            <span class="md-nav__icon md-icon"></span>
            ROSflight Sim
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/running-simulations-with-rosflight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSflight Sim Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/detailed-launching-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Detailed Launching Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/simulator-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simulator Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6">
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ROSplane
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            ROSplane
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/rosplane-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSplane Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/rosplane-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSplane Setup
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_7" checked>
        
          
          <label class="md-nav__link" for="__nav_2_7" id="__nav_2_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ROScopter
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_7">
            <span class="md-nav__icon md-icon"></span>
            ROScopter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roscopter-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROScopter Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roscopter-path-planner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROScopter Path Planner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roscopter-path-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROScopter Path Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    ROScopter Trajectory Follower
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    ROScopter Trajectory Follower
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#responsibility" class="md-nav__link">
    <span class="md-ellipsis">
      Responsibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interface-with-roscopter" class="md-nav__link">
    <span class="md-ellipsis">
      Interface with ROScopter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-trajectory_followerimplementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Using the trajectory_follower/implementation details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the trajectory_follower/implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trajectory-follower-services" class="md-nav__link">
    <span class="md-ellipsis">
      Trajectory Follower Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters and configuration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roscopter-controller/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROScopter Controller
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../roscopter-estimator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROScopter Estimator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_8">
        
          
          <label class="md-nav__link" for="__nav_2_8" id="__nav_2_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Hardware and ROSflight
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_8">
            <span class="md-nav__icon md-icon"></span>
            Hardware and ROSflight
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/getting-started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/hardware-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hardware Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/flight-controller-setup/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Flight Controller Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/rc-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RC Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/parameter-configuration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Configuration
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/preflight-checks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pre-Flight Checks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/improving-firmware-performance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Improving Firmware Performance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/autonomous-flight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Autonomous Flight
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../customizing-rosflight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Customizing ROSflight
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3">
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Developer Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Developer Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/contribution-guidelines/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contribution Guidelines
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/style-guide/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Style Guide
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3">
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Firmware
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Firmware
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/firmware/code-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/firmware/building-and-flashing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Building and Flashing
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/firmware/unit-tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Unit Tests
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/firmware/debugging/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Debugging
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4">
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ROSplane
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            ROSplane
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/rosplane-dev-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_2">
        
          
          <label class="md-nav__link" for="__nav_3_4_2" id="__nav_3_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Controller
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_2">
            <span class="md-nav__icon md-icon"></span>
            Controller
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-general-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    General Controller Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-software-architecture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Controller Software Architecture
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Controller Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-state-machine/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Controller State Machine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-outline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Successive Loop Closure Controller Outline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/controller/controller-total-energy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Total Energy Controller
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_3">
        
          
          <label class="md-nav__link" for="__nav_3_4_3" id="__nav_3_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Estimator
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_3">
            <span class="md-nav__icon md-icon"></span>
            Estimator
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/estimator/estimator-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estimator Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/estimator/estimator-base/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estimator Base
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/estimator/estimator-example/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Estimator Example
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/parameter-management/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter Management
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4_5">
        
          
          <label class="md-nav__link" for="__nav_3_4_5" id="__nav_3_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Navigation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4_5">
            <span class="md-nav__icon md-icon"></span>
            Navigation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/navigation/navigation-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Navigation Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/navigation/path-planner/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Path Planner
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/navigation/path-manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Path Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/rosplane/navigation/path-follower/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Path Follower
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5">
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    ROScopter
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            ROScopter
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../developer-guide/roscopter/roscopter-dev-overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Developer Guide Overview
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4">
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Publications
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Publications
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../publications/rosplane/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSplane
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../publications/rosflight/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ROSflight
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#responsibility" class="md-nav__link">
    <span class="md-ellipsis">
      Responsibility
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#interface-with-roscopter" class="md-nav__link">
    <span class="md-ellipsis">
      Interface with ROScopter
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-the-trajectory_followerimplementation-details" class="md-nav__link">
    <span class="md-ellipsis">
      Using the trajectory_follower/implementation details
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Using the trajectory_follower/implementation details">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#trajectory-follower-services" class="md-nav__link">
    <span class="md-ellipsis">
      Trajectory Follower Services
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#parameters-and-configuration" class="md-nav__link">
    <span class="md-ellipsis">
      Parameters and configuration
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/rosflight/rosflight_docs/edit/main/docs/user-guide/roscopter/roscopter-trajectory-follower.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"></path></svg>
    </a>
  
  


<h1 id="trajectory-follower">Trajectory Follower<a class="headerlink" href="#trajectory-follower" title="Permanent link">¶</a></h1>
<h2 id="responsibility">Responsibility<a class="headerlink" href="#responsibility" title="Permanent link">¶</a></h2>
<p>The responsibility of the <code>trajectory_follower</code> is to produce controller setpoints to follow a given trajectory.</p>
<p>Note that the <code>trajectory_follower</code> does not take in an entire trajectory, but rather a trajectory setpoint <em>at a particular instant in time</em>.</p>
<h2 id="interface-with-roscopter">Interface with ROScopter<a class="headerlink" href="#interface-with-roscopter" title="Permanent link">¶</a></h2>
<table>
<thead>
<tr>
<th style="text-align: center;"><a class="glightbox" data-type="image" data-width="auto" data-height="auto" href="../../images/roscopter_architecture.svg" data-desc-position="bottom"><img alt="Diagram of ROScopter architecture" src="../../images/roscopter_architecture.svg"></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;"><em>Reference diagram of the ROScopter architecture</em></td>
</tr>
</tbody>
</table>
<p>The <code>trajectory_follower</code> interfaces with the rest of ROScopter using publishers and subscribers.</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Subscriber name</th>
<th style="text-align: left;">Message type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>estimated_state</code></td>
<td style="text-align: left;"><code>roscopter_msgs/State</code></td>
<td style="text-align: left;">Estimated state for the vehicle (needs position and orientation)</td>
</tr>
<tr>
<td style="text-align: left;"><code>status</code></td>
<td style="text-align: left;"><code>rosflight_msgs/Status</code></td>
<td style="text-align: left;">Status message from the ROSflight firmware (needs to know when RC control is active)</td>
</tr>
<tr>
<td style="text-align: left;"><code>trajectory_command</code></td>
<td style="text-align: left;"><code>roscopter_msgs/TrajectoryCommand</code></td>
<td style="text-align: left;">Input trajectory command</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align: left;">Publisher name</th>
<th style="text-align: left;">Message type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>high_level_command</code></td>
<td style="text-align: left;"><code>roscopter_msgs/ControllerCommand</code></td>
<td style="text-align: left;">Output commands to the downstream ROScopter controller</td>
</tr>
</tbody>
</table>
<p>To summarize, the <code>trajectory_follower</code> takes in the estimated state (from the <code>estimator</code>) and trajectory setpoints (from the <code>path_manager</code>), and computes and publishes the commands to the <code>controller</code> node.</p>
<h2 id="using-the-trajectory_followerimplementation-details">Using the <code>trajectory_follower</code>/implementation details<a class="headerlink" href="#using-the-trajectory_followerimplementation-details" title="Permanent link">¶</a></h2>
<p>The input trajectory commands are vectors of the form
$$
    u_\text{traj} = [p, \dot{p}, \ddot{p}, \psi, \dot{\psi}, \ddot{\psi}]^T,
$$
where <span class="arithmatex"><span class="MathJax_Preview">p</span><script type="math/tex">p</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\psi</span><script type="math/tex">\psi</script></span> are the desired 3-D position and heading setpoints, respectively.
The derivative terms are feed-forward terms for each setpoint.</p>
<p>The output of the <code>trajectory_follower</code> is controller setpoints of the form
$$
    u_\text{out} = [\phi^c, \theta^c, r^c, T^c]
$$
where <span class="arithmatex"><span class="MathJax_Preview">\phi^c</span><script type="math/tex">\phi^c</script></span> and <span class="arithmatex"><span class="MathJax_Preview">\theta^c</span><script type="math/tex">\theta^c</script></span> are the desired roll and pitch in radians, respectively, and <span class="arithmatex"><span class="MathJax_Preview">r^c</span><script type="math/tex">r^c</script></span> is the desired yaw rate in radians per second.
<span class="arithmatex"><span class="MathJax_Preview">T^c</span><script type="math/tex">T^c</script></span> is the desired thrust, in Newtons.</p>
<p>The trajectory follower is based off of the <a href="https://ieeexplore.ieee.org/document/6095098">"Differential flatness based control of a rotorcraft for aggressive maneuvers"</a> by Ferrin, et al<sup id="fnref:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.
We refer the reader to that paper for information on the implementation and how it works.</p>
<p>There are a number of differences in the ROScopter <code>trajectory_follower</code> not present in the work by Ferrin, et al.</p>
<ol>
<li>
<p>The ROScopter <code>trajectory_follower</code> uses four PID controllers (north, east, down, and yaw) as the nominal controllers, not an LQR controller (as seen in Fig. 2 of the paper).
This means that there are 4 sets of separate PID gains for each controller.</p>
<div class="admonition info">
<p class="admonition-title">Info</p>
<p>The nominal controllers (the PID controllers) have integrators.
To avoid integrator wind-up, the <code>trajectory_follower</code> clears the integrator values when the RC safety pilot has RC override.</p>
<p>The <code>trajectory_follower</code> determines if the safety pilot has control of the vehicle using the <code>status</code> message.</p>
</div>
</li>
<li>
<p>Eq. (16)<sup id="fnref5:1"><a class="footnote-ref" href="#fn:1">1</a></sup> requires computing <span class="arithmatex"><span class="MathJax_Preview">\dot{\theta}</span><script type="math/tex">\dot{\theta}</script></span> (note this is not <span class="arithmatex"><span class="MathJax_Preview">q</span><script type="math/tex">q</script></span>!). The <code>trajectory_follower</code> assumes constant acceleration over the timestep to compute this derivative.</p>
</li>
<li>Before computing <span class="arithmatex"><span class="MathJax_Preview">\boldsymbol{z}</span><script type="math/tex">\boldsymbol{z}</script></span> in Eq. (13)<sup id="fnref2:1"><a class="footnote-ref" href="#fn:1">1</a></sup>, we first saturate <span class="arithmatex"><span class="MathJax_Preview">u_{p_3}</span><script type="math/tex">u_{p_3}</script></span> to avoid instabilities near the origin for Eq. (15)<sup id="fnref3:1"><a class="footnote-ref" href="#fn:1">1</a></sup>.</li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Saturating <span class="arithmatex"><span class="MathJax_Preview">u_{p_3}</span><script type="math/tex">u_{p_3}</script></span> is necessary to prevent poor performance when the trajectory follower tries to track large down setpoints.</p>
<p>The total desired down acceleration is computed as
$$
u_{p_3} = \ddot{p}^c - g
$$
where <span class="arithmatex"><span class="MathJax_Preview">g=9.81</span><script type="math/tex">g=9.81</script></span> is gravity.</p>
<p>When <span class="arithmatex"><span class="MathJax_Preview">\ddot{p}^c</span><script type="math/tex">\ddot{p}^c</script></span> approaches <span class="arithmatex"><span class="MathJax_Preview">+g</span><script type="math/tex">+g</script></span>, then <span class="arithmatex"><span class="MathJax_Preview">u_{p_3}</span><script type="math/tex">u_{p_3}</script></span> approaches <span class="arithmatex"><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>, and Eq. (15)<sup id="fnref4:1"><a class="footnote-ref" href="#fn:1">1</a></sup> returns large values of <span class="arithmatex"><span class="MathJax_Preview">\theta</span><script type="math/tex">\theta</script></span> for small changes in <span class="arithmatex"><span class="MathJax_Preview">z_1</span><script type="math/tex">z_1</script></span>.
Physically, this results in large, rapidly changing pitch commands, resulting in undesirable performance.
Note that this can happen for large nominal (PID) controller output, but also for large feedforward input.</p>
<p>To fix this, we need to make sure <span class="arithmatex"><span class="MathJax_Preview">u_{p_3}</span><script type="math/tex">u_{p_3}</script></span> does not approach <span class="arithmatex"><span class="MathJax_Preview">0</span><script type="math/tex">0</script></span>, or equivalently, <span class="arithmatex"><span class="MathJax_Preview">\ddot{p}^c</span><script type="math/tex">\ddot{p}^c</script></span> does not approach <span class="arithmatex"><span class="MathJax_Preview">+g</span><script type="math/tex">+g</script></span>.
Since free-fall is also usually not desirable (i.e. <span class="arithmatex"><span class="MathJax_Preview">\ddot{p}^c=0</span><script type="math/tex">\ddot{p}^c=0</script></span>), we saturate <span class="arithmatex"><span class="MathJax_Preview">u_{p_3}</span><script type="math/tex">u_{p_3}</script></span> so that
$$
u_{p_3} \in [u_\text{max}, -\infty]
$$
where <span class="arithmatex"><span class="MathJax_Preview">u_\text{max}</span><script type="math/tex">u_\text{max}</script></span> is a negative number controlled by the <code>max_commanded_down_accel_in_gs</code> parameter.</p>
<p>Note that the <code>max_commanded_down_accel_in_gs</code> parameter <strong>should be a negative number</strong>, e.g. <span class="arithmatex"><span class="MathJax_Preview">-0.4</span><script type="math/tex">-0.4</script></span>.
This means that the maximum down command is <span class="arithmatex"><span class="MathJax_Preview">-0.4g</span><script type="math/tex">-0.4g</script></span>.
Since we are using the NED frame, this translates to a minimum of <span class="arithmatex"><span class="MathJax_Preview">0.4g</span><script type="math/tex">0.4g</script></span> commanded output acceleration up, so a maximum <span class="arithmatex"><span class="MathJax_Preview">0.6g</span><script type="math/tex">0.6g</script></span> actual acceleration down.</p>
</div>
<h3 id="trajectory-follower-services">Trajectory Follower Services<a class="headerlink" href="#trajectory-follower-services" title="Permanent link">¶</a></h3>
<p>The <code>trajectory_follower</code> offers the following service server:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Service name</th>
<th style="text-align: left;">Interface type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>clear_integrators</code></td>
<td style="text-align: left;"><code>std_srvs/Trigger</code></td>
<td style="text-align: left;">Clears the integrator values in the nominal PID controllers</td>
</tr>
</tbody>
</table>
<h2 id="parameters-and-configuration">Parameters and configuration<a class="headerlink" href="#parameters-and-configuration" title="Permanent link">¶</a></h2>
<p>The parameters associated with the <code>trajectory_follower</code> are</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Parameter name</th>
<th style="text-align: left;">Parameter type</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><code>down_command_window</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">If input down command to down controller is larger than this parameter, input command gets saturated to this value.</td>
</tr>
<tr>
<td style="text-align: left;"><code>gravity</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">Gravity in <span class="arithmatex"><span class="MathJax_Preview">m/s^2</span><script type="math/tex">m/s^2</script></span></td>
</tr>
<tr>
<td style="text-align: left;"><code>mass</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">Mass of the system in kg</td>
</tr>
<tr>
<td style="text-align: left;"><code>max_commanded_down_accel_in_gs</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">Maximum down acceleration the <code>trajectory_follower</code> can command (in <span class="arithmatex"><span class="MathJax_Preview">g</span><script type="math/tex">g</script></span>'s). See the <a href="#using-the-trajectory_followerimplementation-details">implementation details</a>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>tau</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">Bandwidth of the dirty derivative (for the PID controllers). See the <a href="https://github.com/byu-controlbook/controlbook_public">ControlBook</a>.</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_n_kp</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_p</span><script type="math/tex">k_p</script></span> gain for the north PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_n_ki</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_i</span><script type="math/tex">k_i</script></span> gain for the north PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_n_kd</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_d</span><script type="math/tex">k_d</script></span> gain for the down PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_e_kp</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_p</span><script type="math/tex">k_p</script></span> gain for the east PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_e_ki</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_i</span><script type="math/tex">k_i</script></span> gain for the east PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_e_kd</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_d</span><script type="math/tex">k_d</script></span> gain for the east PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_d_kp</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_p</span><script type="math/tex">k_p</script></span> gain for the down PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_d_ki</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_i</span><script type="math/tex">k_i</script></span> gain for the down PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>u_d_kd</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_d</span><script type="math/tex">k_d</script></span> gain for the down PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>yaw_to_rate_kp</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_p</span><script type="math/tex">k_p</script></span> gain for the yaw angle to yaw rate PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>yaw_to_rate_ki</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_i</span><script type="math/tex">k_i</script></span> gain for the yaw angle to yaw rate PID controller</td>
</tr>
<tr>
<td style="text-align: left;"><code>yaw_to_rate_kd</code></td>
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;"><span class="arithmatex"><span class="MathJax_Preview">k_d</span><script type="math/tex">k_d</script></span> gain for the yaw angle to yaw rate PID controller</td>
</tr>
</tbody>
</table>
<div class="admonition danger">
<p class="admonition-title">Mass and gravity parameters</p>
<p>The <code>gravity</code> and <code>mass</code> parameters <strong>must</strong> be correct.
Otherwise, the <code>trajectory_follower</code> will output incorrect controller commands.</p>
<p>Make sure the <code>mass</code> parameter is the same between all other nodes.</p>
</div>
<p>As described in the <a href="#using-the-trajectory_followerimplementation-details">implementation details section</a>, there are 4 PID controllers, one for north, east, down position, and one for yaw to yaw-rate.
Each controller has a set of PID gains associated with it, and each should be tuned separately.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For multirotors, the north and east configuration of the vehicle is usually symmetric, so the control gains for those two loops are likely to be very similar.</p>
</div>
<p>The <code>down_command_window</code> parameter saturates the input command for the down nominal (PID) controller to avoid large input commands (and thus large output commands).
In other words, if the input command is larger than <code>down_command_window</code>, then the input is saturated to this value.
This parameter exists to help stabilize the drone as it descends.</p>
<div class="admonition warning">
<p class="admonition-title">Important</p>
<p>The <code>down_command_window</code> parameter only applies on the descent, <strong>not on the ascent</strong>.
This is because when the vehicle descends through the prop wash, the airflow can cause instability and shaking.</p>
</div>
<div class="footnote">
<hr>
<ol>
<li id="fn:1">
<p>J. Ferrin, R. Leishman, R. Beard and T. McLain, "Differential flatness based control of a rotorcraft for aggressive maneuvers," 2011 IEEE/RSJ International Conference on Intelligent Robots and Systems, San Francisco, CA, USA, 2011, pp. 2688-2693, doi: 10.1109/IROS.2011.6095098.&nbsp;<a class="footnote-backref" href="#fnref:1" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref2:1" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref3:1" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref4:1" title="Jump back to footnote 1 in the text">↩</a><a class="footnote-backref" href="#fnref5:1" title="Jump back to footnote 1 in the text">↩</a></p>
</li>
</ol>
</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright © 2019-2025, BYU MAGICC Lab
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../..", "features": ["content.action.edit", "navigation.tabs"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
    
  
<script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(()=>{ lightbox.reload(); });
</script></body></html>